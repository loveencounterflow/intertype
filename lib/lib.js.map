{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/lib.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n#===========================================================================================================\nGUY                       = require 'guy'\n{ debug\n  warn }                  = GUY.trm.get_loggers 'demo-execa'\n{ rpr }                   = GUY.trm\n{ hide }                  = GUY.props\n{ props: {\n    nameit } }            = require 'webguy'\n\n\n#===========================================================================================================\n$isa =\n  text:     ( x ) -> typeof x is 'string'\n  function: ( x ) -> ( Object::toString.call x ) is '[object Function]'\n\n#-----------------------------------------------------------------------------------------------------------\n$type_of = ( x ) ->\n  return 'null'         if x is null\n  return 'undefined'    if x is undefined\n  return 'infinity'     if x is +Infinity\n  return 'infinity'     if x is -Infinity\n  return 'boolean'      if x is true\n  return 'boolean'      if x is false\n  return 'text'         if $isa.text      x\n  return 'function'     if $isa.function  x\n  return 'something'\n\n\n#===========================================================================================================\nclass Intertype\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    hide @, 'isa',        @isa.bind       @\n    hide @, 'validate',   @validate.bind  @\n    hide @, 'create',     @create.bind    @\n    hide @, 'type_of',    @type_of.bind   @\n    hide @, 'memo',       new Map()\n    hide @, '_recording', false\n    hide @, '_journal',   null\n    hide @, '_stack',     null\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  isa: ( type, x ) ->\n    ### TAINT use proper validation ###\n    unless type instanceof Type\n      throw new Error \"Ω___2 expected an instance of `Type`, got a #{$type_of R}\"\n    #.......................................................................................................\n    if @_recording\n      @_stack.push type.$typename\n      @_journal.push entry = {}\n    #.......................................................................................................\n    unless ( R = type.isa.call type, x, @ ) in [ true, false, ]\n      throw new Error \"Ω___3 expected `true` or `false`, got a #{$type_of R}\"\n    #.......................................................................................................\n    if @_recording\n      stack = @_stack.join '.'\n      @_stack.pop()\n      Object.assign entry, { type: type.$typename, stack, value: x, verdict: R, }\n    #.......................................................................................................\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  type_of: ( x ) -> 'something'\n\n  #---------------------------------------------------------------------------------------------------------\n  validate: ( type, x ) ->\n    return x if @isa type, x\n    throw new Error \"Ω___4 expected a #{type.$typename}, got a #{$type_of x}\"\n\n  #---------------------------------------------------------------------------------------------------------\n  create: ( type, P... ) ->\n    throw new Error \"Ω___5 not yet implemented\"\n\n  #---------------------------------------------------------------------------------------------------------\n  evaluate: ( type, x ) ->\n    @_recording = true\n    @_journal   = []\n    @_stack     = []\n    #.......................................................................................................\n    @isa type, x\n    #.......................................................................................................\n    R           = @_journal\n    @_recording = false\n    @_journal   = null\n    @_stack     = null\n    return R\n\n\n#===========================================================================================================\nclass Type\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( typespace, typename, declaration ) ->\n    @$typename = typename # hide @, '$typename',  typename\n    hide @, '$typespace', typespace\n    @_compile_fields typespace, typename, declaration if declaration.fields?\n    #.......................................................................................................\n    switch true\n      #.....................................................................................................\n      when $isa.text declaration\n        declaration = do ( typeref = declaration ) => { isa: ( ( x, t ) -> t.isa @$typespace[ typeref ], x ), }\n      #.....................................................................................................\n      when $isa.function declaration\n        declaration = { isa: declaration, }\n      #.....................................................................................................\n      when declaration instanceof Type    then null\n      when declaration instanceof Object  then null\n      #.....................................................................................................\n      else\n        throw new Error \"Ω___6 expected a typename, a function or a type as declaration, got a #{$type_of declaration}\"\n    #.......................................................................................................\n    ### TAINT this is defective w/out proper validation ###\n    for key, value of declaration\n      nameit typename, value if key is 'isa' # check that value is function?\n      hide @, key, value\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_fields: ( typespace, typename, declaration ) ->\n    #.......................................................................................................\n    ### TAINT try to move this check to validation step ###\n    if declaration.isa?\n      throw new Error \"Ω___7 must have exactly one of `isa` or `fields`, not both\"\n    for field_name, field_declaration of declaration.fields\n      declaration.fields[ field_name ] = new Type typespace, field_name, field_declaration\n    #.......................................................................................................\n    declaration.isa = @_get_default_isa_for_fields typespace, typename, declaration\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _get_default_isa_for_fields: ( typespace, typename, declaration ) -> ( x, t ) ->\n    for field_name, field of @fields\n      return false unless x? and t.isa field, x[ field_name ]\n    return true\n\n\n#===========================================================================================================\nclass Typespace\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( typespace_cfg ) ->\n    for typename, declaration of typespace_cfg\n      declaration   = new Type @, typename, declaration unless declaration instanceof Type\n      @[ typename ] = declaration\n    return undefined\n\n\n#===========================================================================================================\n# if module is require.main then await do =>\ndo =>\n  types = new Intertype()\n  module.exports = { Intertype, Type, Typespace, types, }\n"
  ]
}