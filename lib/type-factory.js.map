{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/type-factory.coffee"
  ],
  "names": [],
  "mappings": "AACA;EAAA;AAAA,MAAA,CAAA,EAAA,GAAA,EAAA,CAAA,EAAA,YAAA,EAAA,KAAA,EAAA,IAAA,EAAA,GAAA,EAAA,IAAA,EAAA,IAAA;IAAA,oBAAA;;;EAIA,GAAA,GAA4B,OAAA,CAAQ,KAAR;;EAC5B,CAAA,CAAE,KAAF,EACE,IADF,EAEE,IAFF,EAGE,IAHF,CAAA,GAG4B,GAAG,CAAC,GAAG,CAAC,WAAR,CAAoB,WAApB,CAH5B;;EAIA,CAAA,CAAE,GAAF,CAAA,GAA4B,GAAG,CAAC,GAAhC,EATA;;;EAWA,CAAA,GAA4B,OAAA,CAAQ,UAAR;;EAC5B,CAAA,GAA4B,OAAA,CAAQ,WAAR,EAZ5B;;;EAkBM,eAAN,MAAA,aAAA,QAA2B,CAAC,CAAC,cAA7B,CAAA;;IAGE,WAAa,CAAE,GAAF,CAAA;WACX,CAAA;MACA,IAAC,CAAA,GAAD,GAAO;MACP,IAAC,CAAA,GAAD,GAAO,GAAG,CAAC,GAAG,CAAC,MAAR,CAAe;QAAE,MAAA,EAAQ,CAAE,KAAF,EAAS,EAAT;MAAV,CAAf;AACP,aAAO;IAJI,CADf;;;IAQE,cAAgB,CAAE,IAAF,CAAA;MACd,IAAe,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,aAAZ,CAA0B,IAA1B,CAAf;AAAA,eAAO,KAAP;;MACA,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EACJ,CAAA,gDAAA,CAAA,CAAmD,GAAA,CAAI,IAAJ,CAAnD,CAAA,CADI;IAFQ,CARlB;;;IAcE,aAAe,CAAE,GAAF,CAAA;MACb,IAAyB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,MAAZ,CAA2B,GAA3B,CAAzB;AAAA,eAAO,IAAP;;MACA,IAAyB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,QAAZ,CAA2B,GAA3B,CAAzB;AAAA,eAAO;UAAE,GAAA,EAAK;QAAP,EAAP;;MACA,IAAyB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,aAAZ,CAA2B,GAA3B,CAAzB;AAAA,eAAO;UAAE,GAAA,EAAK;QAAP,EAAP;;MACA,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EACJ,CAAA,4EAAA,CAAA,CAA+E,GAAA,CAAI,GAAJ,CAA/E,CAAA,CADI;IAJO,CAdjB;;;IAsBE,aAAe,CAAE,GAAF,CAAA;MACb,IAAe,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,QAAZ,CAA2B,GAA3B,CAAf;AAAA,eAAO,IAAP;;MACA,IAAe,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,aAAZ,CAA2B,GAA3B,CAAf;AAAA,eAAO,IAAP;;MACA,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EACJ,CAAA,wDAAA,CAAA,CAAyD,GAAA,CAAI,GAAJ,CAAzD,CAAA,CADI;IAHO,CAtBjB;;;IA6BE,mBAAqB,CAAA,GAAE,CAAF,CAAA;AACvB,UAAA,KAAA,EAAA,GAAA,EAAA,GACiB,gCADjB,EAAA,IAAA,EAAA,WAAA,EAAA;MAAI,IAAA,GAAQ;MACR,GAAA,GAAQ,CAAA;MACR,GAAA,GAAQ,KAFZ;;AAII,cAAO,KAAA,GAAQ,CAAC,CAAC,MAAjB;AAAA,aACO,CADP;UAEI,IAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,IAAZ,CAAiB,CAAC,CAAE,CAAF,CAAlB,CAAH;YAAgC,IAAA,GAAQ,IAAC,CAAA,cAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB,EAAxC;WAAA,MAAA;YACgC,GAAA,GAAQ,IAAC,CAAA,aAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB,EADxC;;AADG;AADP,aAIO,CAJP;UAKI,IAAA,GAAU,IAAC,CAAA,cAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB;UACV,GAAA,GAAU,IAAC,CAAA,aAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB;AAFP;AAJP,aAOO,CAPP;UAQI,IAAA,GAAU,IAAC,CAAA,cAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB;UACV,GAAA,GAAU,IAAC,CAAA,aAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB;UACV,GAAA,GAAU,IAAC,CAAA,aAAD,CAAgB,CAAC,CAAE,CAAF,CAAjB;AAHP;AAPP;UAYI,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EAAmC,CAAA,wCAAA,CAAA,CAA2C,KAA3C,CAAA,CAAnC;AAZV,OAJJ;;MAkBI,IAAG,WAAH;QACE,IAAG,GAAG,CAAC,KAAK,CAAC,GAAV,CAAc,GAAd,EAAmB,KAAnB,CAAH;UACE,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EAAmC,sCAAnC,EADR;;QAEA,GAAG,CAAC,GAAJ,GAAY,IAHd;OAlBJ;;MAuBI,IAAG,YAAH;QACE,IAAG,GAAG,CAAC,KAAK,CAAC,GAAV,CAAc,GAAd,EAAmB,MAAnB,CAAH;UACE,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EAAmC,uCAAnC,EADR;;QAEA,GAAG,CAAC,IAAJ,GAAY,KAHd;OAvBJ;;MA4BI,IAAC,CAAA,gBAAD,CAAkB,GAAlB,EA5BJ;;MA8BI,IAAG,eAAH;QACE,IAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,IAAZ,CAAiB,GAAG,CAAC,GAArB,CAAH;UACE,GAAG,CAAC,GAAJ,GAAc,IAAC,CAAA,oBAAD,CAAsB,GAAG,CAAC,GAA1B,EADhB;;QAEA,WAAA,UAAiB,GAAG,CAAC,GAAG,CAAC,mBAAQ,IAAC,CAAA,GAAG,CAAC,QAArB,UAAH,GAAoC,IAApC,GAA8C,GAAG,CAAC,GAAG,CAAC;QACpE,GAAG,CAAC,GAAJ,GAAc,CAAC,CAAC,MAAF,CAAS,CAAA,CAAA,CAAG,GAAG,CAAC,IAAP,CAAA,CAAA,CAAA,CAAe,WAAf,CAAA,CAAT,EAA0C,CAAA,CAAA,CAAA,GAAA;AAC9D,cAAA;UAAQ,CAAA,GAAI,GAAG,CAAC,GAAG,CAAC,IAAR,CAAa,IAAC,CAAA,GAAd;AACJ,iBAAO,CAAE,CAAF,CAAA,GAAA;AACf,gBAAA;AAAU;cACE,CAAA,CAAE,CAAF,EADF;aAEA,cAAA;cAAM;cACJ,IAAe,IAAC,CAAA,GAAG,CAAC,GAAG,CAAC,MAAT,KAAmB,OAAnB,IAA8B,KAAA,YAAiB,CAAC,CAAC,eAAhE;gBAAA,MAAM,MAAN;;cACA,IAAC,CAAA,GAAG,CAAC,KAAK,CAAC,KAAX,GAAmB,MAFrB;;AAGA,mBAAO;UANF;QAF+C,CAAA,GAA1C,EAJhB;OA9BJ;;MA4CI,GAAA,GAAM,CAAE,GAAA,CAAC,CAAC,QAAQ,CAAC,qBAAb,EAAuC,GAAA,GAAvC;MACN,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,qBAAjB,CAAwC,GAAxC,EA7CJ;;AA+CI,aAAO;IAhDY,CA7BvB;;;IAgFE,gBAAkB,CAAE,GAAF,CAAA,EAAA;;AACpB,UAAA,SAAA,EAAA,SAAA,EAAA,MAAA,EAAA,GAAA,EAAA,WAAA,EAAA,IAAA,EAAA,EAAA,EAAA,GAAA,EAAA,IAAA,EAAA,IAAA,EAAA;MACI,MAAA,sCAAsB;MACtB,KAAA,UAAA;;QACE,KAAgB,GAAG,CAAC,UAAJ,CAAe,GAAf,CAAhB;AAAA,mBAAA;;QACA,IAAG,GAAA,KAAO,GAAV;UACE,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EAAmC,uBAAnC,EADR;;QAEA,IAAA,GAAU,GAAG;;UACb,SAAU,CAAA;;QACV,IAAG,mBAAH;UACE,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EAAmC,CAAA,oBAAA,CAAA,CAAuB,GAAA,CAAI,GAAJ,CAAvB,CAAA,CAAnC,EADR;;QAEA,OAAO,GAAG,CAAE,GAAF;QACV,MAAM,CAAE,IAAF,CAAN,GAAiB;MATnB,CAFJ;;MAaI,IAAG,cAAH;QACE,GAAG,CAAC,MAAJ,GAAc;;UACd,GAAG,CAAC,MAAU;SAFhB;OAbJ;;MAiBI,IAAG,kBAAH;QACE,EAAA,GAAK;QACL,KAAO,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,MAAZ,CAAmB,GAAG,CAAC,MAAvB,CAAP;UACE,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EACJ,CAAA,iDAAA,CAAA,CAAkD,GAAA,CAAI,CAAC,CAAC,KAAK,CAAC,OAAR,CAAgB,GAAG,CAAC,MAApB,CAAJ,CAAlD,CAAA,CADI,EADR;;AAGA;QAAA,KAAA,iBAAA;;UACE,IAAG,CAAE,CAAC,CAAC,KAAK,CAAC,OAAR,CAAgB,SAAhB,CAAF,CAAA,KAAiC,MAApC;YACE,SAAA,GAAe,CAAA,CAAE,SAAF,EAAa,SAAb,CAAA,GAAA,EAAA;;qBAEb,CAAC,CAAC,MAAF,CAAS,SAAT,EAAoB,QAAA,CAAE,CAAF,CAAA;uBAAS,IAAC,CAAA,IAAD,CAAM,SAAN,EAAiB,CAAC,CAAE,SAAF,CAAlB;cAAT,CAApB;YAFa,CAAA,EAAE,WAAW,WAD9B;;UAIA,IAAG,CAAE,IAAA,GAAO,CAAC,CAAC,KAAK,CAAC,OAAR,CAAgB,SAAhB,CAAT,CAAA,KAAwC,UAA3C;YACE,EAAA;YACA,WAAA,WAAiB,SAAS,CAAC,mBAAQ,IAAC,CAAA,GAAG,CAAC,QAAvB,WAAH,GAAsC,OAAtC,GAAmD,SAAS,CAAC;YAC3E,GAAG,CAAC,MAAM,CAAE,SAAF,CAAV,GAA0B,CAAC,CAAC,MAAF,CAAS,CAAA,CAAA,CAAG,GAAG,CAAC,IAAP,CAAA,CAAA,CAAA,CAAe,SAAf,CAAA,CAAA,CAAA,CAA4B,WAA5B,CAAA,CAAT,EAAoD,SAAS,CAAC,IAAV,CAAe,IAAC,CAAA,GAAhB,CAApD,EAH5B;WAAA,MAAA;YAKE,MAAM,IAAI,CAAC,CAAC,kBAAN,CAAyB,QAAzB,EAAmC,CAAA,2DAAA,CAAA,CAA8D,GAAA,CAAI,IAAJ,CAA9D,CAAA,CAAnC,EALR;;QALF,CALF;OAjBJ;;AAkCI,aAAO;IAnCS,CAhFpB;;;IAsHE,WAAa,CAAA,GAAE,CAAF,CAAA;AACf,UAAA,CAAA,EAAA,GAAA,EAAA,CAAA,EAAA;MAAI,GAAA,GAAc,IAAC,CAAA,mBAAD,CAAqB,GAAA,CAArB;MACd,IAAG,kBAAH;QACE,CAAA,GAAI,CAAC,CAAC,MAAF,CAAS,GAAG,CAAC,GAAG,CAAC,IAAjB,EAAuB,IAAC,CAAA,mBAAD,CAAA,CAAsB,CAAC,IAAvB,CAA4B,GAA5B,CAAvB,EADN;OAAA,MAAA;QAGE,CAAA,GAAU,GAAG,CAAC;QACd,GAAG,CAAC,GAAJ,GAAU;QACV,KAAA,QAAA;;UAAA,GAAG,CAAC,KAAK,CAAC,IAAV,CAAe,CAAf,EAAkB,CAAlB,EAAqB,CAArB;QAAA;QACA,CAAC,CAAC,MAAF,CAAS,GAAG,CAAC,IAAb,EAAmB,CAAnB,EANF;;AAOA,aAAO,IAAI,GAAG,CAAC,KAAK,CAAC,YAAd,CAA2B;QAAE,MAAA,EAAQ,CAAV;QAAa,OAAA,EAAS;MAAtB,CAA3B;IATI,CAtHf;;;IAkIE,oBAAsB,CAAE,SAAF,CAAA;AACxB,UAAA;MAAI,MAAA,GAAS,SAAS,CAAC,KAAV,CAAgB,IAAC,CAAA,GAAG,CAAC,GAAG,CAAC,GAAzB;aACT,CAAC,CAAC,MAAF,CAAS,SAAT,EAAoB,QAAA,CAAE,CAAF,CAAA;eAAS,IAAC,CAAA,IAAD,CAAM,GAAA,MAAN,EAAiB,CAAjB;MAAT,CAApB;IAFoB,CAlIxB;;;IAuIE,mBAAqB,CAAA,CAAA;aAAG,QAAA,CAAE,CAAF,CAAA;AAC1B,YAAA,CAAA,EAAA,CAAA,EAAA,CAAA,EAAA;QAEM,IAAgB,CAAE,CAAA,GAAI,IAAC,CAAA,GAAD,CAAK,CAAL,CAAN,CAAA,KAAkB,KAAlC;;;AAAA,iBAAO,MAAP;;QACA,IAAgB,CAAA,KAAK,IAArB;AAAA,iBAAO,EAAP;;AACA;QAAA,KAAA,QAAA;;UACE,IAAgB,CAAE,CAAA,GAAI,CAAA,CAAE,CAAF,CAAN,CAAA,KAAe,KAA/B;AAAA,mBAAO,MAAP;;UACA,IAAgB,CAAA,KAAK,IAArB;AAAA,mBAAO,EAAP;;QAFF;AAGA,eAAO;MARa;IAAH;;EAzIvB,EAlBA;;;;;;;;EA4KA,IAAC,CAAA,YAAD,GAAgB;AA5KhB",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ debug\n  warn\n  urge\n  help }                  = GUY.trm.get_loggers 'INTERTYPE'\n{ rpr }                   = GUY.trm\n#...........................................................................................................\nE                         = require './errors'\nH                         = require './helpers'\n\n\n\n\n#===========================================================================================================\nclass Type_factory extends H.Intertype_abc\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( hub ) ->\n    super()\n    @hub = hub\n    @cfg = GUY.lft.freeze { rename: [ 'isa', '', ], }\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _validate_name: ( name ) ->\n    return name if H.types.isa.nonempty_text name\n    throw new E.Intertype_ETEMPTBD '^tf@1^', \\\n      \"expected a nonempty text for new type name, got #{rpr name}\"\n\n  #---------------------------------------------------------------------------------------------------------\n  _validate_dsc: ( dsc ) ->\n    return dsc            if H.types.isa.object         dsc\n    return { isa: dsc, }  if H.types.isa.function       dsc\n    return { isa: dsc, }  if H.types.isa.nonempty_text  dsc\n    throw new E.Intertype_ETEMPTBD '^tf@2^', \\\n      \"expected an object, a function or a nonempty text for type description, got #{rpr dsc}\"\n\n  #---------------------------------------------------------------------------------------------------------\n  _validate_isa: ( isa ) ->\n    return isa  if H.types.isa.function       isa\n    return isa  if H.types.isa.nonempty_text  isa\n    throw new E.Intertype_ETEMPTBD '^tf@3^', \\\n      \"expected a function or a nonempty text for `isa`, got #{rpr isa}\"\n\n  #---------------------------------------------------------------------------------------------------------\n  _normalize_type_cfg: ( P... ) ->\n    name  = null\n    dsc   = {}   ### short for type DeSCription ###\n    isa   = null\n    #.......................................................................................................\n    switch arity = P.length\n      when 1\n        if H.types.isa.text P[ 0 ] then name  = @_validate_name P[ 0 ]\n        else                            dsc   = @_validate_dsc  P[ 0 ]\n      when 2\n        name    = @_validate_name P[ 0 ]\n        dsc     = @_validate_dsc  P[ 1 ]\n      when 3\n        name    = @_validate_name P[ 0 ]\n        dsc     = @_validate_dsc  P[ 1 ]\n        isa     = @_validate_isa  P[ 2 ]\n      else\n        throw new E.Intertype_ETEMPTBD '^tf@4^', \"expected between 1 and 3 arguments, got #{arity}\"\n    #.......................................................................................................\n    if isa?\n      if GUY.props.has dsc, 'isa'\n        throw new E.Intertype_ETEMPTBD '^tf@5^', \"got two conflicting values for `isa`\"\n      dsc.isa   = isa\n    #.......................................................................................................\n    if name?\n      if GUY.props.has dsc, 'name'\n        throw new E.Intertype_ETEMPTBD '^tf@6^', \"got two conflicting values for `name`\"\n      dsc.name  = name\n    #.......................................................................................................\n    @_assemble_fields dsc\n    #.......................................................................................................\n    if dsc.isa?\n      if H.types.isa.text dsc.isa\n        dsc.isa     = @_test_from_hedgepath dsc.isa\n      name_of_isa = if dsc.isa.name in @cfg.rename then '#0' else dsc.isa.name\n      dsc.isa     = H.nameit \"#{dsc.name}:#{name_of_isa}\", do =>\n        f = dsc.isa.bind @hub\n        return ( x ) =>\n          try\n            f x\n          catch error\n            throw error if @hub.cfg.errors is 'throw' or error instanceof E.Intertype_error\n            @hub.state.error = error\n          return false\n    #.......................................................................................................\n    dsc = { H.defaults.Type_factory_type_dsc..., dsc..., }\n    H.types.validate.Type_factory_type_dsc  dsc\n    #.......................................................................................................\n    return dsc\n\n  #---------------------------------------------------------------------------------------------------------\n  _assemble_fields: ( dsc ) ->\n    ### Re-assemble fields in `fields` property, delete `$`-prefixed keys ###\n    fields = dsc.fields ? null\n    for key, field_dsc of dsc\n      continue unless key.startsWith '$'\n      if key is '$'\n        throw new E.Intertype_ETEMPTBD '^tf@7^', \"found illegal key '$'\"\n      nkey    = key[ 1 .. ]\n      fields ?= {}\n      if fields[ key ]?\n        throw new E.Intertype_ETEMPTBD '^tf@8^', \"found duplicate key #{rpr key}\"\n      delete dsc[ key ]\n      fields[ nkey ] = field_dsc\n    #.......................................................................................................\n    if fields?\n      dsc.fields  = fields\n      dsc.isa    ?= 'object'\n    #.......................................................................................................\n    if dsc.fields?\n      nr = 0\n      unless H.types.isa.object dsc.fields\n        throw new E.Intertype_ETEMPTBD '^tf@8^', \\\n          \"expected an object for `field` property, got a #{rpr H.types.type_of dsc.fields}\"\n      for fieldname, field_dsc of dsc.fields\n        if ( H.types.type_of field_dsc ) is 'text'\n          field_dsc = do ( fieldname, field_dsc ) =>\n            # H.nameit field_dsc, ( x ) -> @_isa field_dsc, GUY.props.get x, fieldname, undefined\n            H.nameit field_dsc, ( x ) -> @_isa field_dsc, x[ fieldname ]\n        if ( type = H.types.type_of field_dsc ) is 'function'\n          nr++\n          name_of_isa = if field_dsc.name in @cfg.rename then '#{nr}' else field_dsc.name\n          dsc.fields[ fieldname ] = H.nameit \"#{dsc.name}.#{fieldname}:#{name_of_isa}\", field_dsc.bind @hub\n        else\n          throw new E.Intertype_ETEMPTBD '^tf@8^', \"expected a text or a function for field description, got a #{rpr type}\"\n    #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  create_type: ( P... ) ->\n    dsc         = @_normalize_type_cfg P...\n    if dsc.fields?\n      R = H.nameit dsc.isa.name, @_create_test_walker().bind dsc\n    else\n      R       = dsc.isa\n      dsc.isa = null\n      GUY.props.hide R, k, v for k, v of dsc\n      H.nameit dsc.name, R\n    return new GUY.props.Strict_owner { target: R, oneshot: true, }\n\n  #---------------------------------------------------------------------------------------------------------\n  _test_from_hedgepath: ( hedgepath ) ->\n    hedges = hedgepath.split @hub.cfg.sep\n    H.nameit hedgepath, ( x ) -> @_isa hedges..., x\n\n  #---------------------------------------------------------------------------------------------------------\n  _create_test_walker: -> ( x ) ->\n    # try\n    #   ### TAINT use `@isa()` or `@_isa()` ? ###\n      return false if ( R = @isa x ) is false\n      return R unless R is true\n      for _, f of @fields\n        return false if ( R = f x ) is false\n        return R unless R is true\n      return true\n    # catch error\n    #   throw error if @hub.cfg.errors is 'throw' or error instanceof E.Intertype_error\n    #   @hub.state.error = error\n    # return false\n\n\n\n############################################################################################################\n@Type_factory = Type_factory\n\n"
  ]
}